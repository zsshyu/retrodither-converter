<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RetroDither Converter</title>
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 -5 100 100'%3E%3Crect x='20' y='20' width='60' height='60' fill='white' stroke='black' stroke-width='6'/%3E%3Cline x1='-5' y1='70' x2='105' y2='30' stroke='black' stroke-width='8'/%3E%3C/svg%3E" />
</head>

<body class="bg-bg-primary text-text-primary min-h-screen font-light">
  <div id="app" class="flex flex-col h-screen">
    <!-- Header -->
    <header
      class="bg-bg-secondary border-b border-bg-tertiary px-6 py-4 flex-shrink-0 flex justify-between items-center">
      <div>
        <h1 class="text-xl font-mono-title tracking-wide">RetroDither Converter</h1>
        <p id="subtitle" class="text-text-secondary text-sm font-light">Retro Dither Style Generator</p>
      </div>
      <div class="flex items-center gap-2">
        <select id="language-select"
          class="bg-bg-tertiary border border-bg-tertiary rounded px-2 py-1 text-sm focus:outline-none focus:border-accent cursor-pointer">
          <option value="en">EN</option>
          <option value="zh">‰∏≠Êñá</option>
          <option value="fr">FR</option>
        </select>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden min-h-0">
      <!-- Preview Area -->
      <div class="flex-1 flex flex-col min-h-[300px] lg:min-h-0 p-4 order-1 lg:order-1">
        <!-- Upload Area (shown when no image) -->
        <div id="upload-area"
          class="flex-1 flex items-center justify-center border-2 border-dashed border-bg-tertiary rounded-lg hover:border-accent transition-colors cursor-pointer min-h-[200px]">
          <div class="text-center p-8">
            <div class="text-4xl mb-4">üìÅ</div>
            <p id="upload-hint" class="text-text-secondary mb-2">Drag & drop image here or click to upload</p>
            <p id="upload-support" class="text-text-secondary text-sm">Supports JPG, PNG, WebP (max 4096x4096)</p>
            <input type="file" id="file-input" accept="image/*" class="hidden" />
          </div>
        </div>

        <!-- Canvas Area (shown when image loaded) -->
        <div id="canvas-area" class="hidden flex-1 flex flex-col min-h-[200px]">
          <div id="canvas-container"
            class="flex-1 relative overflow-auto bg-bg-secondary rounded-lg min-h-[150px] flex items-center justify-center">
            <div id="canvas-wrapper" class="relative">
              <canvas id="preview-canvas"></canvas>
              <canvas id="original-canvas" class="hidden absolute top-0 left-0"></canvas>
            </div>
            <!-- Loading Overlay -->
            <div id="loading-overlay" class="hidden absolute inset-0 bg-black/50 flex items-center justify-center">
              <div class="text-center">
                <div class="animate-spin w-8 h-8 border-2 border-accent border-t-transparent rounded-full mx-auto mb-2">
                </div>
                <p id="processing-text" class="text-sm">Processing...</p>
              </div>
            </div>
          </div>
          <!-- Canvas Controls -->
          <div class="flex gap-2 mt-3 flex-wrap">
            <button id="compare-btn"
              class="px-4 py-2 bg-bg-tertiary rounded hover:bg-accent hover:text-black transition-colors text-sm">
              Hold to compare
            </button>
            <button id="new-image-btn"
              class="px-4 py-2 bg-bg-tertiary rounded hover:bg-accent hover:text-black transition-colors text-sm">
              Upload new
            </button>
          </div>
        </div>
      </div>

      <!-- Control Panel -->
      <aside id="control-panel"
        class="w-full lg:w-80 bg-bg-secondary border-t lg:border-t-0 lg:border-l border-bg-tertiary p-4 overflow-y-auto flex-shrink-0 order-2 lg:order-2 max-h-[50vh] lg:max-h-none">
        <div class="space-y-6">
          <!-- Presets -->
          <section>
            <label id="label-preset" class="block text-sm font-bold mb-2">Presets</label>
            <select id="preset-select"
              class="w-full bg-bg-tertiary border border-bg-tertiary rounded px-3 py-2 text-sm focus:outline-none focus:border-accent">
              <option value="" id="option-custom">Custom</option>
            </select>
          </section>

          <!-- Palette -->
          <section>
            <h3 id="heading-palette" class="text-sm font-bold mb-3 text-accent">Palette</h3>
            <div class="mb-2">
              <label id="label-color-count" class="block text-xs text-text-secondary mb-1">Colors</label>
              <select id="color-count"
                class="w-full bg-bg-tertiary border border-bg-tertiary rounded px-3 py-2 text-sm focus:outline-none focus:border-accent">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4" selected>4</option>
              </select>
            </div>
            <div id="palette-editors" class="flex gap-1 rounded overflow-hidden border border-bg-tertiary">
              <!-- Color inputs will be generated by JS -->
            </div>
          </section>

          <!-- Pixel Size -->
          <section>
            <label class="block text-sm font-bold mb-2">
              <span id="label-pixel-size">Pixel Size</span> <span id="pixel-size-value" class="text-accent">1px</span>
            </label>
            <input type="range" id="pixel-size" min="1" max="32" value="1" class="w-full accent-accent" />
          </section>

          <!-- Bloom Controls (New) -->
          <section class="border-t border-bg-tertiary pt-4">
            <h3 id="heading-bloom" class="text-sm font-bold mb-3 text-accent">Bloom Effect</h3>

            <div class="mb-3">
              <label class="block text-xs text-text-secondary mb-1">
                <span id="label-bloom-intensity">Intensity</span> <span id="bloom-intensity-value"
                  class="text-accent ml-1">0%</span>
              </label>
              <input type="range" id="bloom-intensity" min="0" max="100" value="0" class="w-full accent-accent" />
            </div>

            <div class="mb-3">
              <label class="block text-xs text-text-secondary mb-1">
                <span id="label-bloom-threshold">Threshold</span> <span id="bloom-threshold-value"
                  class="text-accent ml-1">180</span>
              </label>
              <input type="range" id="bloom-threshold" min="0" max="255" value="180" class="w-full accent-accent" />
            </div>

            <div>
              <label class="block text-xs text-text-secondary mb-1">
                <span id="label-bloom-radius">Radius</span> <span id="bloom-radius-value"
                  class="text-accent ml-1">4px</span>
              </label>
              <input type="range" id="bloom-radius" min="1" max="20" value="4" class="w-full accent-accent" />
            </div>
          </section>

          <!-- Brightness & Contrast -->
          <section class="border-t border-bg-tertiary pt-4">
            <h3 id="heading-adjustments" class="text-sm font-bold mb-3 text-accent">Adjustments</h3>
            <div class="mb-3">
              <label class="block text-sm font-medium mb-2">
                <span id="label-brightness">Brightness</span> <span id="brightness-value" class="text-accent">0</span>
              </label>
              <input type="range" id="brightness" min="-100" max="100" value="0" class="w-full accent-accent" />
            </div>

            <div>
              <label class="block text-sm font-medium mb-2">
                <span id="label-contrast">Contrast</span> <span id="contrast-value" class="text-accent">20</span>
              </label>
              <input type="range" id="contrast" min="-100" max="200" value="20" class="w-full accent-accent" />
            </div>
          </section>

          <!-- Algorithm -->
          <section id="algorithm-section" class="border-t border-bg-tertiary pt-4">
            <h3 id="heading-dithering" class="text-sm font-bold mb-3 text-accent">Dithering</h3>
            <label id="label-algorithm" class="block text-sm font-medium mb-2">Algorithm</label>
            <select id="algorithm"
              class="w-full bg-bg-tertiary border border-bg-tertiary rounded px-3 py-2 text-sm focus:outline-none focus:border-accent mb-3">
              <option value="bayer" id="option-bayer">Bayer (Ordered)</option>
              <option value="none" id="option-none">None (No Dithering)</option>
            </select>

            <!-- Matrix Size (only for Bayer) -->
            <div id="matrix-section" class="mb-3">
              <label id="label-matrix" class="block text-sm font-medium mb-2">Matrix Size</label>
              <select id="matrix-size"
                class="w-full bg-bg-tertiary border border-bg-tertiary rounded px-3 py-2 text-sm focus:outline-none focus:border-accent">
                <option value="2">2x2</option>
                <option value="4" selected>4x4</option>
                <option value="8">8x8</option>
                <option value="16">16x16</option>
                <option value="32">32x32</option>
              </select>
            </div>

            <!-- Dither Threshold/Bias -->
            <div id="threshold-section">
              <label class="block text-sm font-medium mb-2">
                <span id="label-threshold">Dither Bias</span> <span id="threshold-value" class="text-accent">128</span>
              </label>
              <input type="range" id="threshold" min="0" max="255" value="128" class="w-full accent-accent" />
            </div>
          </section>



          <!-- Noise -->
          <section class="border-t border-bg-tertiary pt-4">
            <h3 id="heading-noise" class="text-sm font-bold mb-3 text-accent">Noise</h3>
            <div class="mb-3">
              <label id="label-noise-type" class="block text-sm font-medium mb-2">Noise Type</label>
              <select id="noise-type"
                class="w-full bg-bg-tertiary border border-bg-tertiary rounded px-3 py-2 text-sm focus:outline-none focus:border-accent">
                <option value="grayscale" id="option-grayscale">Grayscale</option>
                <option value="rgb" id="option-rgb">RGB Color (CRT Effect)</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium mb-2">
                <span id="label-noise-amount">Noise Amount</span> <span id="noise-value" class="text-accent">0%</span>
              </label>
              <input type="range" id="noise" min="0" max="100" value="0" class="w-full accent-accent" />
            </div>
          </section>

          <!-- Actions -->
          <section class="flex gap-2 pt-4 border-t border-bg-tertiary">
            <button id="reset-btn"
              class="flex-1 px-4 py-2 bg-bg-tertiary rounded hover:bg-red-600 transition-colors text-sm">
              Reset
            </button>
            <button id="download-btn"
              class="flex-1 px-4 py-2 bg-accent text-black rounded hover:bg-accent-hover transition-colors text-sm font-medium">
              Download
            </button>
          </section>

          <!-- Export Options -->
          <section id="export-options" class="hidden space-y-3 p-3 bg-bg-tertiary rounded">
            <div>
              <label id="label-format" class="block text-xs text-text-secondary mb-1">Format</label>
              <select id="export-format"
                class="w-full bg-bg-secondary border border-bg-tertiary rounded px-2 py-1 text-sm">
                <option value="png">PNG</option>
                <option value="jpeg">JPEG</option>
                <option value="webp">WebP</option>
              </select>
            </div>
            <div>
              <label id="label-scale" class="block text-xs text-text-secondary mb-1">Scale</label>
              <select id="export-scale"
                class="w-full bg-bg-secondary border border-bg-tertiary rounded px-2 py-1 text-sm">
                <option value="1" id="option-scale-1">1x (Original)</option>
                <option value="2">2x</option>
                <option value="4">4x</option>
              </select>
            </div>
            <button id="confirm-download-btn"
              class="w-full px-4 py-2 bg-accent text-black rounded hover:bg-accent-hover transition-colors text-sm font-medium">
              Confirm Download
            </button>
          </section>
        </div>
      </aside>
    </main>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>

</html>